---
name: Performance Requirements
description: Performance budgets and optimization rules
---

# Performance Rules

## Re-render Prevention

### Rule 1: Memoize Components Receiving Props
```tsx
export const MyComponent = React.memo(function MyComponent({ data }) {
  // Component code
});
```

### Rule 2: Stable Callbacks
```tsx
const handlePress = useCallback(() => {
  doSomething();
}, []); // Only recreate when dependencies change
```

### Rule 3: Never Create Objects in Render
```tsx
// ❌ BAD - Creates new object every render
<Component style={{ padding: 10 }} />

// ✅ GOOD - Stable reference
const styles = { padding: 10 };
<Component style={styles} />
```

## Debugging Tools

### whyDidYouRender (Catch Unnecessary Re-renders)
Add during development to identify performance issues:

```tsx
// dev/App.tsx or any component file
import whyDidYouRender from '@welldone-software/why-did-you-render';

if (__DEV__) {
  whyDidYouRender(React, {
    trackAllPureComponents: true,
    logOnDifferentValues: true,
  });
}

// Mark components to track
MyComponent.whyDidYouRender = true;
```

**Install**:
```bash
bun add -D @welldone-software/why-did-you-render
```

**Usage**: Console will show why components re-rendered (props changed, state changed, etc.)

### Performance Monitoring (Automated Warnings)
Add to components during development:

```tsx
function MyComponent(props) {
  const renderCount = useRef(0);
  const lastRenderTime = useRef(Date.now());
  
  useEffect(() => {
    renderCount.current++;
    const now = Date.now();
    const timeSinceLastRender = now - lastRenderTime.current;
    
    // Warn if rendering more than 20x per second
    if (timeSinceLastRender < 50 && renderCount.current > 5) {
      console.warn(
        `⚠️ ${MyComponent.name} rendering too frequently!`,
        `${renderCount.current} renders in ${timeSinceLastRender}ms`
      );
    }
    
    lastRenderTime.current = now;
  });
  
  return (/* ... */);
}
```

## Performance Budgets

### Test: Component should render 1000x in <100ms
```tsx
it('renders efficiently', () => {
  const { rerender } = render(<Component />);
  const start = performance.now();
  for (let i = 0; i < 1000; i++) {
    rerender(<Component />);
  }
  expect(performance.now() - start).toBeLessThan(100);
});
```

## Streaming Apps Specific
- Control panels MUST NOT re-render during streaming
- Use React Context for frequently changing data
- Pass counts/lengths, not full strings as props
- Test with streaming simulator (50ms intervals)
